<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î ‡∏ô‡πâ‡∏≠‡∏á‡∏≠‡∏¥‡∏ô‡∏≠‡∏¥‡∏ô üíñ</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<div id="fireworkOverlay"></div>
<body>
  <!-- Intro Screen -->
   <div id="blackOverlay"></div>

<div id="intro-screen">
  
  <div class="intro-content">
    <button id="startBtn">‡∏û‡∏£‡πâ‡∏≠‡∏°</button>
    <img id="birthdayCake" src="cake.png" alt="‡πÄ‡∏Ñ‡πâ‡∏Å‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î"/>
    <h2 id="wishText">‡πÄ‡∏õ‡πà‡∏≤‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô‡πÄ‡∏•‡∏¢‡∏¢‡∏¢</h2>
  </div>
  <audio id="introMusic" src="happy.mp3"></audio>
</div>

  <div class="overlay">
    <div class="container">
      <h1>‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î ‡∏ô‡πâ‡∏≠‡∏á‡∏≠‡∏¥‡∏ô‡∏≠‡∏¥‡∏ô üíñ</h1>
      <p>‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏ü‡∏ô‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏°‡∏≤‡∏Å‡πÜ ‡∏≠‡∏¢‡∏≤‡∏Å‡∏£‡∏±‡∏Å‡πÅ‡∏ü‡∏ô‡πÑ‡∏õ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢‡πÜ</p>
      <p>‡∏ñ‡πâ‡∏≤‡πÅ‡∏ü‡∏ô‡∏á‡∏≠‡∏ô‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏á‡πâ‡∏≠ ‡∏£‡∏±‡∏Å‡πÅ‡∏ü‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏î‡∏î‡∏î~</p>
      <p>‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡πÅ‡∏ü‡∏ô‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡πÑ‡∏´‡∏ô ‡πÅ‡∏á‡∏á‡∏á‡∏á‡∏á‡∏á‡∏á‡∏á</p>
      <p>‡πÅ‡∏ü‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡πà1 ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡πÄ‡∏™‡∏°‡∏≠‡∏≠‡∏≠ ‡∏à‡∏∏‡πâ‡∏ö‡∏û‡∏µ‡πà‡∏≠‡∏¥‡∏ô‡∏≠‡∏¥‡∏ô‡∏ô</p>
      <img src="inin.png" alt="‡∏≠‡∏¥‡∏ô‡∏≠‡∏¥‡∏ô" class="photo"/>
  <img src="https://i.pinimg.com/originals/a5/7b/f9/a57bf940269ffbf167f8b0c5fd50315c.gif" class="sticker bottom-left" />
  <img src="https://i.pinimg.com/originals/a5/7b/f9/a57bf940269ffbf167f8b0c5fd50315c.gif" class="sticker bottom-right" />

<!-- ‡∏•‡∏ö iframe YouTube ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ audio ‡πÅ‡∏ó‡∏ô -->
<audio id="bgm" src="music.mp3" loop></audio>

<button id="giftBtn">üéÅ ‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç</button>

<!-- ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç + ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå -->
<div class="gift-scene" id="giftScene">
  <img src="https://images.icon-icons.com/2639/PNG/512/gif_box_icon_159270.png" alt="‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç" class="gift-box" />
  <div class="flash"></div>
  <img src="gift.png" alt="‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç" class="gift-result" />
</div>
      <!-- YouTube iframe ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô -->
      <div id="playerContainer" class="music" style="display:none;">
        <iframe
          id="ytplayer"
          width="0"
          height="0"
          src=""
          frameborder="0"
          allow="autoplay"
          allowfullscreen
        ></iframe>
      </div>
    </div>
  </div>

  <script>
const intro = document.getElementById("intro-screen");
const startBtn = document.getElementById("startBtn");
const cake = document.getElementById("birthdayCake");
const wish = document.getElementById("wishText");
const introMusic = document.getElementById("introMusic");

function startMicDetection() {
  navigator.mediaDevices.getUserMedia({ audio: true })
    .then((stream) => {
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const source = audioContext.createMediaStreamSource(stream);
      const analyser = audioContext.createAnalyser();
      analyser.fftSize = 512;
      const dataArray = new Uint8Array(analyser.fftSize);
      source.connect(analyser);

      const threshold = 50;
      let detected = false;
      const maxWaitTime = 20000;
      const displayDuration = 10000;
      const startTime = Date.now();

      const checkVolume = () => {
        analyser.getByteTimeDomainData(dataArray);
        let sum = 0;
        for (let i = 0; i < dataArray.length; i++) {
          const val = (dataArray[i] - 128) / 128;
          sum += val * val;
        }
        const volume = Math.sqrt(sum / dataArray.length) * 100;

        if (volume > threshold && !detected) {
          detected = true;
          showBirthdayMessage();
setTimeout(() => {
  hideBirthdayMessage();
  proceedToMainContent();
}, 5000);
        } else if (!detected && Date.now() - startTime < maxWaitTime) {
          requestAnimationFrame(checkVolume);
        } else if (!detected) {
          proceedToMainContent();
        }
      };

      checkVolume();
    })
    .catch((err) => {
      console.error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏°‡πÇ‡∏Ñ‡∏£‡πÇ‡∏ü‡∏ô:', err);
      proceedToMainContent();
    });
}

function showBirthdayMessage() {
  const intro = document.getElementById("intro-screen");

  // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏õ‡πá‡∏ô GIF ‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ‡πÑ‡∏ü
  intro.style.backgroundColor = "transparent";
  intro.style.backgroundImage = "url('https://i.pinimg.com/originals/b7/38/85/b738852f3a04af828898babb2c2c063d.gif')";
  intro.style.backgroundSize = "cover";
  intro.style.backgroundRepeat = "no-repeat";
  intro.style.backgroundPosition = "center";

  // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° popup
  const popup = document.createElement("div");
  popup.className = "birthday-popup";
  popup.textContent = "‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î üéâ";
  intro.appendChild(popup);

  // ‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏û‡∏•‡∏á‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
  const bgm = document.getElementById("bgm");
  bgm.volume = 1;
  bgm.play();

  // ‡∏Ñ‡πà‡∏≠‡∏¢‡πÜ‡∏•‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏û‡∏•‡∏á intro
  const fadeOut = setInterval(() => {
    if (introMusic.volume > 0.05) {
      introMusic.volume -= 0.05;
    } else {
      introMusic.volume = 0;
      introMusic.pause();
      clearInterval(fadeOut);
    }
  }, 250); // 0.05 x 20 = 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
  

  // ‡∏û‡∏∑‡πâ‡∏ô‡∏î‡∏≥‡πÉ‡∏´‡∏°‡πà‡∏ã‡πâ‡∏≠‡∏ô‡∏ó‡∏±‡∏ö‡∏´‡∏•‡∏±‡∏á 4 ‡∏ß‡∏¥
  const overlay = document.getElementById("blackOverlay");
  setTimeout(() => {
    overlay.style.opacity = "1";
    setTimeout(() => {
      overlay.style.opacity = "1";
      setTimeout(() => {
        overlay.style.opacity = "0";
      }, 1000);
    }, 1000);
  }, 4000);
}

function hideBirthdayMessage() {
  const popup = document.querySelector(".birthday-popup");
  if (popup) popup.remove();

  const intro = document.getElementById("intro-screen");
  intro.style.background = "black"; // ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏î‡∏≥
}





function proceedToMainContent() {
  intro.style.opacity = 0;
  setTimeout(() => {
    intro.style.display = "none";
  }, 2000);
}

startBtn.addEventListener("click", () => {
  startBtn.style.display = "none";
  cake.style.opacity = "1";
  introMusic.volume = 0;
  introMusic.play();

  let volume = 0;
  const fadeInMusic = setInterval(() => {
    if (volume < 1) {
      volume += 0.05;
      introMusic.volume = volume;
    } else {
      clearInterval(fadeInMusic);
    }
  }, 200);

  setTimeout(() => {
    wish.style.opacity = "1";
  }, 5000);

  setTimeout(() => {
    startMicDetection(); // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏±‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏Ñ‡πâ‡∏Å
  }, 5000);
});

// ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏û‡∏•‡∏á
document.getElementById("playButton").addEventListener("click", () => {
  const bgm = document.getElementById("bgm");
  bgm.play().catch((err) => {
    alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏û‡∏•‡∏á‡πÑ‡∏î‡πâ ‡∏≠‡∏≤‡∏à‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏•‡∏¥‡∏Å‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ö‡∏•‡πá‡∏≠‡∏Å‡πÑ‡∏ß‡πâ");
    console.error(err);
  });
  document.getElementById("playButton").style.display = "none";
});

// ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏´‡∏±‡∏ß‡πÉ‡∏à
document.addEventListener("click", (e) => {
  const heart = document.createElement("div");
  heart.textContent = "üíñ";
  heart.style.position = "absolute";
  heart.style.top = e.clientY + "px";
  heart.style.left = e.clientX + "px";
  heart.style.fontSize = "30px";
  heart.style.pointerEvents = "none";
  heart.style.opacity = "0.8";
  heart.style.animation = "fadeUp 2s ease-out forwards";
  document.body.appendChild(heart);
  setTimeout(() => heart.remove(), 2000);
});

// ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç
document.getElementById("giftBtn").addEventListener("click", () => {
  const scene = document.getElementById("giftScene");
  const result = scene.querySelector(".gift-result");
  const flash = scene.querySelector(".flash");
  const box = scene.querySelector(".gift-box");

  scene.style.display = "flex";
  result.style.display = "none";
  result.style.opacity = 0;
  flash.style.animation = "none";
  box.style.animation = "shakeFancy 1.5s ease-in-out";

  setTimeout(() => {
    flash.style.animation = "flashGlow 1.5s ease-out forwards";
  }, 1500);

  setTimeout(() => {
    result.style.display = "block";
    result.style.animation = "riseAndFade 1.5s ease-out forwards";
    result.onclick = () => {
      scene.style.animation = "fadeOut 0.6s ease-out forwards";
      setTimeout(() => {
        scene.style.display = "none";
        scene.style.animation = "";
        result.style.display = "none";
        result.style.animation = "";
        flash.style.animation = "none";
      }, 600);
    };
  }, 2700);
});
</script>

</body>
</html>
