<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î ‡∏ô‡πâ‡∏≠‡∏á‡∏≠‡∏¥‡∏ô‡∏≠‡∏¥‡∏ô üíñ</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
  <div id="fireworkOverlay"></div>
  <!-- Intro Screen -->
   <div id="blackOverlay"></div>

<div id="intro-screen">
  
  <div class="intro-content">
    <button id="startBtn">‡∏Å‡∏î‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</button>
    <img id="birthdayCake" src="cake.png" alt="‡πÄ‡∏Ñ‡πâ‡∏Å‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î"/>
    <h2 id="wishText">‡πÄ‡∏õ‡πà‡∏≤‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô‡πÄ‡∏•‡∏¢‡∏¢‡∏¢</h2>
  </div>
  <audio id="introMusic" src="happy.mp3"></audio>
</div>

  <div class="overlay">
    <div class="container">
  <h1>‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î ‡∏ô‡πâ‡∏≠‡∏á‡∏≠‡∏¥‡∏ô‡∏≠‡∏¥‡∏ô üíñ</h1>
  <div id="typedText" class="typed-text"></div>
  <img src="inin.png" alt="‡∏≠‡∏¥‡∏ô‡∏≠‡∏¥‡∏ô" class="photo"/>
  <img src="https://i.pinimg.com/originals/a5/7b/f9/a57bf940269ffbf167f8b0c5fd50315c.gif" class="sticker bottom-left" />
  <img src="https://i.pinimg.com/originals/a5/7b/f9/a57bf940269ffbf167f8b0c5fd50315c.gif" class="sticker bottom-right" />

<!-- ‡∏•‡∏ö iframe YouTube ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ audio ‡πÅ‡∏ó‡∏ô -->
<audio id="bgm" src="music.mp3" loop></audio>

<button id="giftBtn">‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç</button>
<button id="gachaBtn">‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏à‡∏∏‡πà‡∏°‡∏°‡∏°</button>
<div id="gachaResult" class="gacha-result"></div>

<!-- ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç + ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå -->
<div class="gift-scene" id="giftScene">
  <img src="https://images.icon-icons.com/2639/PNG/512/gif_box_icon_159270.png" alt="‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç" class="gift-box" />
  <div class="flash"></div>
  <img src="gift.png" alt="‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç" class="gift-result" />
</div>
      <!-- YouTube iframe ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô -->
      <div id="playerContainer" class="music" style="display:none;">
        <iframe
          id="ytplayer"
          width="0"
          height="0"
          src=""
          frameborder="0"
          allow="autoplay"
          allowfullscreen
        ></iframe>
      </div>
    </div>
  </div>

  <script>
const intro = document.getElementById("intro-screen");
const startBtn = document.getElementById("startBtn");
const cake = document.getElementById("birthdayCake");
const wish = document.getElementById("wishText");
const introMusic = document.getElementById("introMusic");
let micPermissionGranted = false;
let micStreamRef = null;

document.addEventListener("DOMContentLoaded", () => {
  navigator.mediaDevices.getUserMedia({
    audio: {
      echoCancellation: true,
      noiseSuppression: true,
      autoGainControl: true
    }
  }).then((stream) => {
    micPermissionGranted = true;
    micStreamRef = stream;
    console.log("üé§ ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÑ‡∏°‡πÇ‡∏Ñ‡∏£‡πÇ‡∏ü‡∏ô‡πÅ‡∏•‡πâ‡∏ß");
  }).catch((err) => {
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏°‡πÇ‡∏Ñ‡∏£‡πÇ‡∏ü‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏ô‡∏∞‡∏Ñ‡∏∞ ü•∫");
    console.error("‡πÑ‡∏°‡πÇ‡∏Ñ‡∏£‡πÇ‡∏ü‡∏ô‡∏ñ‡∏π‡∏Å‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò:", err);
  });
});

function startMicDetection() {
  const useStream = micStreamRef
    ? Promise.resolve(micStreamRef)
    : navigator.mediaDevices.getUserMedia({
        audio: {
          echoCancellation: true,
          noiseSuppression: true,
          autoGainControl: true
        }
      });

  useStream.then((stream) => {
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const source = audioContext.createMediaStreamSource(stream);
    const analyser = audioContext.createAnalyser();
    analyser.fftSize = 512;
    const dataArray = new Uint8Array(analyser.fftSize);
    source.connect(analyser);

    const threshold = 50;
    let detected = false;
    const maxWaitTime = 20000;
    const startTime = Date.now();

    const checkVolume = () => {
      analyser.getByteTimeDomainData(dataArray);
      let sum = 0;
      for (let i = 0; i < dataArray.length; i++) {
        const val = (dataArray[i] - 128) / 128;
        sum += val * val;
      }
      const volume = Math.sqrt(sum / dataArray.length) * 100;

      if (volume > threshold && !detected) {
        detected = true;
        showBirthdayMessage();
        setTimeout(() => {
          hideBirthdayMessage();
          proceedToMainContent();
        }, 5000);
      } else if (!detected && Date.now() - startTime < maxWaitTime) {
        requestAnimationFrame(checkVolume);
      } else if (!detected) {
        proceedToMainContent();
      }
    };

    checkVolume();
  }).catch((err) => {
    console.error("‡πÑ‡∏°‡πÇ‡∏Ñ‡∏£‡πÇ‡∏ü‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°:", err);
    proceedToMainContent();
  });
}

function showBirthdayMessage() {
  const intro = document.getElementById("intro-screen");

  // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏õ‡πá‡∏ô GIF ‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ‡πÑ‡∏ü
  intro.style.backgroundColor = "transparent";
  intro.style.backgroundImage = "url('https://i.pinimg.com/originals/b7/38/85/b738852f3a04af828898babb2c2c063d.gif')";
  intro.style.backgroundSize = "cover";
  intro.style.backgroundRepeat = "no-repeat";
  intro.style.backgroundPosition = "center";

  // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° popup
  const popup = document.createElement("div");
  popup.className = "birthday-popup";
  popup.textContent = "‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î üéâ";
  intro.appendChild(popup);

  // ‡∏õ‡∏¥‡∏î‡πÑ‡∏°‡πÇ‡∏Ñ‡∏£‡πÇ‡∏ü‡∏ô (‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏™‡∏î‡∏á popup)
  if (micStreamRef) {
    micStreamRef.getTracks().forEach(track => track.stop());
    micStreamRef = null;
    console.log("üîá ‡∏õ‡∏¥‡∏î‡πÑ‡∏°‡πÇ‡∏Ñ‡∏£‡πÇ‡∏ü‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
  }

  // ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏û‡∏•‡∏á‡∏´‡∏•‡∏±‡∏Å
  const bgm = document.getElementById("bgm");
  bgm.volume = 1;
  bgm.play();

  // ‡∏•‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á introMusic
  const fadeOut = setInterval(() => {
    if (introMusic.volume > 0.05) {
      introMusic.volume -= 0.05;
    } else {
      introMusic.volume = 0;
      introMusic.pause();
      clearInterval(fadeOut);
    }
  }, 250); // 5 ‡∏ß‡∏¥‡∏û‡∏≠‡∏î‡∏µ

  // ‡∏û‡∏∑‡πâ‡∏ô‡∏î‡∏≥‡πÉ‡∏´‡∏°‡πà‡∏ã‡πâ‡∏≠‡∏ô‡∏ó‡∏±‡∏ö‡∏´‡∏•‡∏±‡∏á 4 ‡∏ß‡∏¥
  const overlay = document.getElementById("blackOverlay");
  setTimeout(() => {
    overlay.style.opacity = "1";
    setTimeout(() => {
      overlay.style.opacity = "1";
      setTimeout(() => {
        overlay.style.opacity = "0";
      }, 1000);
    }, 1000);
  }, 4000);
}

function hideBirthdayMessage() {
  const popup = document.querySelector(".birthday-popup");
  if (popup) popup.remove();

  const intro = document.getElementById("intro-screen");
  intro.style.background = "black";
}

function proceedToMainContent() {
  intro.style.opacity = 0;
  setTimeout(() => {
    intro.style.display = "none";
  }, 2000);
}

startBtn.addEventListener("click", () => {
  startBtn.style.display = "none";
  cake.style.opacity = "1";
  introMusic.volume = 0;
  introMusic.play();

  let volume = 0;
  const fadeInMusic = setInterval(() => {
    if (volume < 1) {
      volume += 0.05;
      introMusic.volume = volume;
    } else {
      clearInterval(fadeInMusic);
    }
  }, 200);

  setTimeout(() => {
    wish.style.opacity = "1";
  }, 5000);

  setTimeout(() => {
    startMicDetection();
  }, 5000);
});

// ‡∏•‡∏ö: ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏û‡∏•‡∏á (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏µ‡∏Å‡πÅ‡∏•‡πâ‡∏ß)

// ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏´‡∏±‡∏ß‡πÉ‡∏à
document.addEventListener("click", (e) => {
  const heart = document.createElement("div");
  heart.textContent = "üíñ";
  heart.style.position = "absolute";
  heart.style.top = e.clientY + "px";
  heart.style.left = e.clientX + "px";
  heart.style.fontSize = "30px";
  heart.style.pointerEvents = "none";
  heart.style.opacity = "0.8";
  heart.style.zIndex = "10001"; // ‚úÖ ‡πÉ‡∏™‡πà z-index ‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤‡∏™‡∏¥‡πà‡∏á‡∏≠‡∏∑‡πà‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
  heart.style.animation = "fadeUp 2s ease-out forwards";
  document.body.appendChild(heart);
  setTimeout(() => heart.remove(), 2000);
});


// ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç
document.getElementById("giftBtn").addEventListener("click", () => {
  const scene = document.getElementById("giftScene");
  const result = scene.querySelector(".gift-result");
  const flash = scene.querySelector(".flash");

  // ‡∏´‡∏≤‡∏Å‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°
  let box = scene.querySelector(".gift-box");
  if (!box) {
    box = document.createElement("img");
    box.src = "https://images.icon-icons.com/2639/PNG/512/gif_box_icon_159270.png";
    box.alt = "‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç";
    box.className = "gift-box";
    scene.insertBefore(box, result);
  }

  scene.style.display = "flex";
  result.style.display = "none";
  result.style.opacity = 0;
  flash.style.animation = "none";

  // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï animation ‡∏Å‡∏•‡πà‡∏≠‡∏á
  box.style.animation = "none";
  void box.offsetWidth; // force reflow
  box.style.animation = "shakeFancyLong 2.5s ease-in-out";

  setTimeout(() => {
    flash.style.animation = "flashGlowBig 1.2s ease-out forwards";
  }, 2500);

  setTimeout(() => {
    result.style.display = "block";
    result.style.animation = "riseAndFade 1.5s ease-out forwards";

    // ‡∏•‡∏ö‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å DOM
    box.remove();

    result.onclick = () => {
      scene.style.animation = "fadeOut 0.6s ease-out forwards";
      setTimeout(() => {
        scene.style.display = "none";
        scene.style.animation = "";
        result.style.display = "none";
        result.style.animation = "";
        flash.style.animation = "none";
      }, 600);
    };
  }, 3700);
});




function typeTextByChar(containerId, message, speed = 120) {
  const container = document.getElementById(containerId);
  let i = 0;

  function typeChar() {
    if (i < message.length) {
      if (message[i] === "\n") {
        container.appendChild(document.createElement("br"));
      } else {
        const span = document.createElement("span");
        span.textContent = message[i];
        span.style.opacity = 0;
        span.style.transition = "opacity 0.3s ease";
        container.appendChild(span);

        setTimeout(() => {
          span.style.opacity = 1;
        }, 10);
      }
      i++;
      setTimeout(typeChar, speed);
    }
  }

  container.innerHTML = "";
  typeChar();
}
function proceedToMainContent() {
  intro.style.opacity = 0;
  setTimeout(() => {
    intro.style.display = "none";
    typeTextByChar("typedText", `‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏ü‡∏ô‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏°‡∏≤‡∏Å‡πÜ ‡∏≠‡∏¢‡∏≤‡∏Å‡∏£‡∏±‡∏Å‡πÅ‡∏ü‡∏ô‡πÑ‡∏õ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢‡πÜ\n‡∏ñ‡πâ‡∏≤‡πÅ‡∏ü‡∏ô‡∏á‡∏≠‡∏ô‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏á‡πâ‡∏≠ ‡∏£‡∏±‡∏Å‡πÅ‡∏ü‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏î‡∏î‡∏î~\n‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡πÅ‡∏ü‡∏ô‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡πÑ‡∏´‡∏ô ‡πÅ‡∏á‡∏á‡∏á‡∏á‡∏á‡∏á‡∏á‡∏á\n‡πÅ‡∏ü‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡πà1 ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡πÄ‡∏™‡∏°‡∏≠‡∏≠‡∏≠ ‡∏à‡∏∏‡πâ‡∏ö‡πÜ‡πÜ‡πÜ‡∏û‡∏µ‡πà‡∏≠‡∏¥‡∏ô‡∏≠‡∏¥‡∏ô‡∏ô‡∏ô‡∏ô‡∏ô`);
  }, 2000);
}

const gachaItems = [
  "‡∏à‡∏∏‡πä‡∏ö‡πÅ‡∏Å‡πâ‡∏°",
  "‡∏Å‡∏≠‡∏î",
  "‡∏™‡∏±‡πà‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏ô",
  "‡∏ó‡∏≥‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ö‡∏≠‡∏Å",
  "‡∏Å‡∏¥‡∏ô‡πÄ‡∏Ñ‡πâ‡∏Å1‡∏Ñ‡∏≥",
  "‡∏õ‡πâ‡∏≠‡∏ô‡πÄ‡∏Ñ‡πâ‡∏Å1‡∏Ñ‡∏≥",
  "‡πÉ‡∏´‡πâ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏ô‡∏´‡∏•‡∏±‡∏ö‡∏ï‡∏≤",
  "‡∏Å‡∏±‡∏î‡∏î‡∏î",
  "‡∏õ‡∏¥‡∏î‡∏ï‡∏≤‡∏≤‡∏≤ ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏ô‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡∏Å‡πá‡πÑ‡∏î‡πâ",
  "‡∏à‡∏∏‡πä‡∏ö‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô‡∏Å‡πá‡πÑ‡∏î‡πâ",
  "‡∏´‡∏≠‡∏°‡πÅ‡∏Å‡πâ‡∏°",
  "‡∏•‡∏π‡∏ö‡∏´‡∏±‡∏ß",
  "‡∏ó‡∏≥‡∏ú‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡∏´‡∏±‡∏ß‡πÉ‡∏à",
  "‡∏Å‡∏≠‡∏î‡∏î‡∏î‡∏î‡∏î",
  "‡∏≠‡πâ‡∏≠‡∏ô‡∏ô",
  "‡∏û‡∏π‡∏î‡∏´‡∏ß‡∏≤‡∏ô‡πÜ",
  "‡∏´‡∏≠‡∏°‡πÅ‡∏Å‡πâ‡∏°",
  "‡∏¢‡∏¥‡πâ‡∏°‡∏´‡∏ô‡πà‡∏≠‡∏¢"
];

document.getElementById("gachaBtn").addEventListener("click", () => {
  const resultBox = document.getElementById("gachaResult");
  let count = 0;
  let maxCount = 40;
  let baseDelay = 50;
  let delay = baseDelay;

  resultBox.style.color = "#FFD700"; // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏î‡πâ‡∏ß‡∏¢‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á
  resultBox.classList.remove("gacha-bounce"); // ‡∏•‡πâ‡∏≤‡∏á‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°

  function spinGacha() {
    const item = gachaItems[Math.floor(Math.random() * gachaItems.length)];
    resultBox.textContent = `üéÅ ${item}`;

    count++;
    if (count < maxCount) {
      delay += (7000 / maxCount - baseDelay) / maxCount;
      setTimeout(spinGacha, delay);
    } else {
      // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡πÅ‡∏•‡∏∞‡πÄ‡∏ï‡πâ‡∏ô
      setTimeout(() => {
        resultBox.style.color = "#ff69b4";
        resultBox.classList.add("gacha-bounce");
        setTimeout(() => {
          resultBox.classList.remove("gacha-bounce");
        }, 600);
      }, 200);
    }
  }

  spinGacha();
});




</script>
</body>
</html>
